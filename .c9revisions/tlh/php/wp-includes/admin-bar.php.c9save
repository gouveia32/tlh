{"ts":1381265268537,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n/**\n * Admin Bar\n *\n * This code handles the building and rendering of the press bar.\n */\n\n/**\n * Instantiate the admin bar object and set it up as a global for access elsewhere.\n *\n * UNHOOKING THIS FUNCTION WILL NOT PROPERLY REMOVE THE ADMIN BAR.\n * For that, use show_admin_bar(false) or the 'show_admin_bar' filter.\n *\n * @since 3.1.0\n * @access private\n * @return bool Whether the admin bar was successfully initialized.\n */\nfunction _wp_admin_bar_init() {\n\tglobal $wp_admin_bar;\n\n\tif ( ! is_admin_bar_showing() )\n\t\treturn false;\n\n\t/* Load the admin bar class code ready for instantiation */\n\trequire( ABSPATH . WPINC . '/class-wp-admin-bar.php' );\n\n\t/* Instantiate the admin bar */\n\t$admin_bar_class = apply_filters( 'wp_admin_bar_class', 'WP_Admin_Bar' );\n\tif ( class_exists( $admin_bar_class ) )\n\t\t$wp_admin_bar = new $admin_bar_class;\n\telse\n\t\treturn false;\n\n\t$wp_admin_bar->initialize();\n\t$wp_admin_bar->add_menus();\n\n\treturn true;\n}\n// Don't remove. Wrong way to disable.\nadd_action( 'template_redirect', '_wp_admin_bar_init', 0 );\nadd_action( 'admin_init', '_wp_admin_bar_init' );\n\n/**\n * Render the admin bar to the page based on the $wp_admin_bar->menu member var.\n * This is called very late on the footer actions so that it will render after anything else being\n * added to the footer.\n *\n * It includes the action \"admin_bar_menu\" which should be used to hook in and\n * add new menus to the admin bar. That way you can be sure that you are adding at most optimal point,\n * right before the admin bar is rendered. This also gives you access to the $post global, among others.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_render() {\n\tglobal $wp_admin_bar;\n\n\tif ( ! is_admin_bar_showing() || ! is_object( $wp_admin_bar ) )\n\t\treturn false;\n\n\tdo_action_ref_array( 'admin_bar_menu', array( &$wp_admin_bar ) );\n\n\tdo_action( 'wp_before_admin_bar_render' );\n\n\t$wp_admin_bar->render();\n\n\tdo_action( 'wp_after_admin_bar_render' );\n}\nadd_action( 'wp_footer', 'wp_admin_bar_render', 1000 );\nadd_action( 'in_admin_header', 'wp_admin_bar_render', 0 );\n\n/**\n * Add the WordPress logo menu.\n *\n * @since 3.3.0\n */\nfunction wp_admin_bar_wp_menu( $wp_admin_bar ) {\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'wp-logo',\n\t\t'title' => '<span class=\"ab-icon\"></span>',\n\t\t'href'  => self_admin_url( 'about.php' ),\n\t\t'meta'  => array(\n\t\t\t'title' => __('About WordPress'),\n\t\t),\n\t) );\n\n\tif ( is_user_logged_in() ) {\n\t\t// Add \"About WordPress\" link\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'wp-logo',\n\t\t\t'id'     => 'about',\n\t\t\t'title'  => __('About WordPress'),\n\t\t\t'href'  => self_admin_url( 'about.php' ),\n\t\t) );\n\t}\n\n\t// Add WordPress.org link\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent'    => 'wp-logo-external',\n\t\t'id'        => 'wporg',\n\t\t'title'     => __('WordPress.org'),\n\t\t'href'      => __('http://wordpress.org/'),\n\t) );\n\n\t// Add codex link\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent'    => 'wp-logo-external',\n\t\t'id'        => 'documentation',\n\t\t'title'     => __('Documentation'),\n\t\t'href'      => __('http://codex.wordpress.org/'),\n\t) );\n\n\t// Add forums link\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent'    => 'wp-logo-external',\n\t\t'id'        => 'support-forums',\n\t\t'title'     => __('Support Forums'),\n\t\t'href'      => __('http://wordpress.org/support/'),\n\t) );\n\n\t// Add feedback link\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent'    => 'wp-logo-external',\n\t\t'id'        => 'feedback',\n\t\t'title'     => __('Feedback'),\n\t\t'href'      => __('http://wordpress.org/support/forum/requests-and-feedback'),\n\t) );\n}\n\n/**\n * Add the \"My Account\" item.\n *\n * @since 3.3.0\n */\nfunction wp_admin_bar_my_account_item( $wp_admin_bar ) {\n\t$user_id      = get_current_user_id();\n\t$current_user = wp_get_current_user();\n\t$profile_url  = get_edit_profile_url( $user_id );\n\n\tif ( ! $user_id )\n\t\treturn;\n\n\t$avatar = get_avatar( $user_id, 16 );\n\t$howdy  = sprintf( __('Howdy, %1$s'), $current_user->display_name );\n\t$class  = empty( $avatar ) ? '' : 'with-avatar';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'        => 'my-account',\n\t\t'parent'    => 'top-secondary',\n\t\t'title'     => $howdy . $avatar,\n\t\t'href'      => $profile_url,\n\t\t'meta'      => array(\n\t\t\t'class'     => $class,\n\t\t\t'title'     => __('My Account'),\n\t\t),\n\t) );\n}\n\n/**\n * Add the \"My Account\" submenu items.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_my_account_menu( $wp_admin_bar ) {\n\t$user_id      = get_current_user_id();\n\t$current_user = wp_get_current_user();\n\t$profile_url  = get_edit_profile_url( $user_id );\n\n\tif ( ! $user_id )\n\t\treturn;\n\n\t$wp_admin_bar->add_group( array(\n\t\t'parent' => 'my-account',\n\t\t'id'     => 'user-actions',\n\t) );\n\n\t$user_info  = get_avatar( $user_id, 64 );\n\t$user_info .= \"<span class='display-name'>{$current_user->display_name}</span>\";\n\n\tif ( $current_user->display_name !== $current_user->user_login )\n\t\t$user_info .= \"<span class='username'>{$current_user->user_login}</span>\";\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent' => 'user-actions',\n\t\t'id'     => 'user-info',\n\t\t'title'  => $user_info,\n\t\t'href'   => $profile_url,\n\t\t'meta'   => array(\n\t\t\t'tabindex' => -1,\n\t\t),\n\t) );\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent' => 'user-actions',\n\t\t'id'     => 'edit-profile',\n\t\t'title'  => __( 'Edit My Profile' ),\n\t\t'href' => $profile_url,\n\t) );\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent' => 'user-actions',\n\t\t'id'     => 'logout',\n\t\t'title'  => __( 'Log Out' ),\n\t\t'href'   => wp_logout_url(),\n\t) );\n}\n\n/**\n * Add the \"Site Name\" menu.\n *\n * @since 3.3.0\n */\nfunction wp_admin_bar_site_menu( $wp_admin_bar ) {\n\tglobal $current_site;\n\n\t// Don't show for logged out users.\n\tif ( ! is_user_logged_in() )\n\t\treturn;\n\n\t// Show only when the user is a member of this site, or they're a super admin.\n\tif ( ! is_user_member_of_blog() && ! is_super_admin() )\n\t\treturn;\n\n\t$blogname = get_bloginfo('name');\n\n\tif ( empty( $blogname ) )\n\t\t$blogname = preg_replace( '#^(https?://)?(www.)?#', '', get_home_url() );\n\n\tif ( is_network_admin() ) {\n\t\t$blogname = sprintf( __('Network Admin: %s'), esc_html( $current_site->site_name ) );\n\t} elseif ( is_user_admin() ) {\n\t\t$blogname = sprintf( __('Global Dashboard: %s'), esc_html( $current_site->site_name ) );\n\t}\n\n\t$title = wp_html_excerpt( $blogname, 40, '&hellip;' );\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'site-name',\n\t\t'title' => $title,\n\t\t'href'  => is_admin() ? home_url( '/' ) : admin_url(),\n\t) );\n\n\t// Create submenu items.\n\n\tif ( is_admin() ) {\n\t\t// Add an option to visit the site.\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'site-name',\n\t\t\t'id'     => 'view-site',\n\t\t\t'title'  => __( 'Visit Site' ),\n\t\t\t'href'   => home_url( '/' ),\n\t\t) );\n\n\t\tif ( is_blog_admin() && is_multisite() && current_user_can( 'manage_sites' ) ) {\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'parent' => 'site-name',\n\t\t\t\t'id'     => 'edit-site',\n\t\t\t\t'title'  => __( 'Edit Site' ),\n\t\t\t\t'href'   => network_admin_url( 'site-info.php?id=' . get_current_blog_id() ),\n\t\t\t) );\n\t\t}\n\n\t} else {\n\t\t// We're on the front end, link to the Dashboard.\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'site-name',\n\t\t\t'id'     => 'dashboard',\n\t\t\t'title'  => __( 'Dashboard' ),\n\t\t\t'href'   => admin_url(),\n\t\t) );\n\n\t\t// Add the appearance submenu items.\n\t\twp_admin_bar_appearance_menu( $wp_admin_bar );\n\t}\n}\n\n/**\n * Add the \"My Sites/[Site Name]\" menu and all submenus.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_my_sites_menu( $wp_admin_bar ) {\n\tglobal $wpdb;\n\n\t// Don't show for logged out users or single site mode.\n\tif ( ! is_user_logged_in() || ! is_multisite() )\n\t\treturn;\n\n\t// Show only when the user has at least one site, or they're a super admin.\n\tif ( count( $wp_admin_bar->user->blogs ) < 1 && ! is_super_admin() )\n\t\treturn;\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'my-sites',\n\t\t'title' => __( 'My Sites' ),\n\t\t'href'  => admin_url( 'my-sites.php' ),\n\t) );\n\n\tif ( is_super_admin() ) {\n\t\t$wp_admin_bar->add_group( array(\n\t\t\t'parent' => 'my-sites',\n\t\t\t'id'     => 'my-sites-super-admin',\n\t\t) );\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'my-sites-super-admin',\n\t\t\t'id'     => 'network-admin',\n\t\t\t'title'  => __('Network Admin'),\n\t\t\t'href'   => network_admin_url(),\n\t\t) );\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'network-admin',\n\t\t\t'id'     => 'network-admin-d',\n\t\t\t'title'  => __( 'Dashboard' ),\n\t\t\t'href'   => network_admin_url(),\n\t\t) );\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'network-admin',\n\t\t\t'id'     => 'network-admin-s',\n\t\t\t'title'  => __( 'Sites' ),\n\t\t\t'href'   => network_admin_url( 'sites.php' ),\n\t\t) );\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'network-admin',\n\t\t\t'id'     => 'network-admin-u',\n\t\t\t'title'  => __( 'Users' ),\n\t\t\t'href'   => network_admin_url( 'users.php' ),\n\t\t) );\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => 'network-admin',\n\t\t\t'id'     => 'network-admin-v',\n\t\t\t'title'  => __( 'Visit Network' ),\n\t\t\t'href'   => network_home_url(),\n\t\t) );\n\t}\n\n\t// Add site links\n\t$wp_admin_bar->add_group( array(\n\t\t'parent' => 'my-sites',\n\t\t'id'     => 'my-sites-list',\n\t\t'meta'   => array(\n\t\t\t'class' => is_super_admin() ? 'ab-sub-secondary' : '',\n\t\t),\n\t) );\n\n\tforeach ( (array) $wp_admin_bar->user->blogs as $blog ) {\n\t\tswitch_to_blog( $blog->userblog_id );\n\n\t\t$blavatar = '<div class=\"blavatar\"></div>';\n\n\t\t$blogname = empty( $blog->blogname ) ? $blog->domain : $blog->blogname;\n\t\t$menu_id  = 'blog-' . $blog->userblog_id;\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent'    => 'my-sites-list',\n\t\t\t'id'        => $menu_id,\n\t\t\t'title'     => $blavatar . $blogname,\n\t\t\t'href'      => admin_url(),\n\t\t) );\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => $menu_id,\n\t\t\t'id'     => $menu_id . '-d',\n\t\t\t'title'  => __( 'Dashboard' ),\n\t\t\t'href'   => admin_url(),\n\t\t) );\n\n\t\tif ( current_user_can( get_post_type_object( 'post' )->cap->create_posts ) ) {\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'parent' => $menu_id,\n\t\t\t\t'id'     => $menu_id . '-n',\n\t\t\t\t'title'  => __( 'New Post' ),\n\t\t\t\t'href'   => admin_url( 'post-new.php' ),\n\t\t\t) );\n\t\t}\n\n\t\tif ( current_user_can( 'edit_posts' ) ) {\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'parent' => $menu_id,\n\t\t\t\t'id'     => $menu_id . '-c',\n\t\t\t\t'title'  => __( 'Manage Comments' ),\n\t\t\t\t'href'   => admin_url( 'edit-comments.php' ),\n\t\t\t) );\n\t\t}\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent' => $menu_id,\n\t\t\t'id'     => $menu_id . '-v',\n\t\t\t'title'  => __( 'Visit Site' ),\n\t\t\t'href'   => home_url( '/' ),\n\t\t) );\n\n\t\trestore_current_blog();\n\t}\n}\n\n/**\n * Provide a shortlink.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_shortlink_menu( $wp_admin_bar ) {\n\t$short = wp_get_shortlink( 0, 'query' );\n\t$id = 'get-shortlink';\n\n\tif ( empty( $short ) )\n\t\treturn;\n\n\t$html = '<input class=\"shortlink-input\" type=\"text\" readonly=\"readonly\" value=\"' . esc_attr( $short ) . '\" />';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id' => $id,\n\t\t'title' => __( 'Shortlink' ),\n\t\t'href' => $short,\n\t\t'meta' => array( 'html' => $html ),\n\t) );\n}\n\n/**\n * Provide an edit link for posts and terms.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_edit_menu( $wp_admin_bar ) {\n\tglobal $tag, $wp_the_query;\n\n\tif ( is_admin() ) {\n\t\t$current_screen = get_current_screen();\n\t\t$post = get_post();\n\n\t\tif ( 'post' == $current_screen->base\n\t\t\t&& 'add' != $current_screen->action\n\t\t\t&& ( $post_type_object = get_post_type_object( $post->post_type ) )\n\t\t\t&& current_user_can( 'read_post', $post->ID )\n\t\t\t&& ( $post_type_object->public )\n\t\t\t&& ( $post_type_object->show_in_admin_bar ) )\n\t\t{\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'id' => 'view',\n\t\t\t\t'title' => $post_type_object->labels->view_item,\n\t\t\t\t'href' => get_permalink( $post->ID )\n\t\t\t) );\n\t\t} elseif ( 'edit-tags' == $current_screen->base\n\t\t\t&& isset( $tag ) && is_object( $tag )\n\t\t\t&& ( $tax = get_taxonomy( $tag->taxonomy ) )\n\t\t\t&& $tax->public )\n\t\t{\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'id' => 'view',\n\t\t\t\t'title' => $tax->labels->view_item,\n\t\t\t\t'href' => get_term_link( $tag )\n\t\t\t) );\n\t\t}\n\t} else {\n\t\t$current_object = $wp_the_query->get_queried_object();\n\n\t\tif ( empty( $current_object ) )\n\t\t\treturn;\n\n\t\tif ( ! empty( $current_object->post_type )\n\t\t\t&& ( $post_type_object = get_post_type_object( $current_object->post_type ) )\n\t\t\t&& current_user_can( 'edit_post', $current_object->ID )\n\t\t\t&& $post_type_object->show_ui && $post_type_object->show_in_admin_bar )\n\t\t{\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'id' => 'edit',\n\t\t\t\t'title' => $post_type_object->labels->edit_item,\n\t\t\t\t'href' => get_edit_post_link( $current_object->ID )\n\t\t\t) );\n\t\t} elseif ( ! empty( $current_object->taxonomy )\n\t\t\t&& ( $tax = get_taxonomy( $current_object->taxonomy ) )\n\t\t\t&& current_user_can( $tax->cap->edit_terms )\n\t\t\t&& $tax->show_ui )\n\t\t{\n\t\t\t$wp_admin_bar->add_menu( array(\n\t\t\t\t'id' => 'edit',\n\t\t\t\t'title' => $tax->labels->edit_item,\n\t\t\t\t'href' => get_edit_term_link( $current_object->term_id, $current_object->taxonomy )\n\t\t\t) );\n\t\t}\n\t}\n}\n\n/**\n * Add \"Add New\" menu.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_new_content_menu( $wp_admin_bar ) {\n\t$actions = array();\n\n\t$cpts = (array) get_post_types( array( 'show_in_admin_bar' => true ), 'objects' );\n\n\tif ( isset( $cpts['post'] ) && current_user_can( $cpts['post']->cap->create_posts ) )\n\t\t$actions[ 'post-new.php' ] = array( $cpts['post']->labels->name_admin_bar, 'new-post' );\n\n\tif ( isset( $cpts['attachment'] ) && current_user_can( 'upload_files' ) )\n\t\t$actions[ 'media-new.php' ] = array( $cpts['attachment']->labels->name_admin_bar, 'new-media' );\n\n\tif ( current_user_can( 'manage_links' ) )\n\t\t$actions[ 'link-add.php' ] = array( _x( 'Link', 'add new from admin bar' ), 'new-link' );\n\n\tif ( isset( $cpts['page'] ) && current_user_can( $cpts['page']->cap->create_posts ) )\n\t\t$actions[ 'post-new.php?post_type=page' ] = array( $cpts['page']->labels->name_admin_bar, 'new-page' );\n\n\tunset( $cpts['post'], $cpts['page'], $cpts['attachment'] );\n\n\t// Add any additional custom post types.\n\tforeach ( $cpts as $cpt ) {\n\t\tif ( ! current_user_can( $cpt->cap->create_posts ) )\n\t\t\tcontinue;\n\n\t\t$key = 'post-new.php?post_type=' . $cpt->name;\n\t\t$actions[ $key ] = array( $cpt->labels->name_admin_bar, 'new-' . $cpt->name );\n\t}\n\t// Avoid clash with parent node and a 'content' post type.\n\tif ( isset( $actions['post-new.php?post_type=content'] ) )\n\t\t$actions['post-new.php?post_type=content'][1] = 'add-new-content';\n\n\tif ( current_user_can( 'create_users' ) || current_user_can( 'promote_users' ) )\n\t\t$actions[ 'user-new.php' ] = array( _x( 'User', 'add new from admin bar' ), 'new-user' );\n\n\tif ( ! $actions )\n\t\treturn;\n\n\t$title = '<span class=\"ab-icon\"></span><span class=\"ab-label\">' . _x( 'New', 'admin bar menu group label' ) . '</span>';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'new-content',\n\t\t'title' => $title,\n\t\t'href'  => admin_url( current( array_keys( $actions ) ) ),\n\t\t'meta'  => array(\n\t\t\t'title' => _x( 'Add New', 'admin bar menu group label' ),\n\t\t),\n\t) );\n\n\tforeach ( $actions as $link => $action ) {\n\t\tlist( $title, $id ) = $action;\n\n\t\t$wp_admin_bar->add_menu( array(\n\t\t\t'parent'    => 'new-content',\n\t\t\t'id'        => $id,\n\t\t\t'title'     => $title,\n\t\t\t'href'      => admin_url( $link )\n\t\t) );\n\t}\n}\n\n/**\n * Add edit comments link with awaiting moderation count bubble.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_comments_menu( $wp_admin_bar ) {\n\tif ( !current_user_can('edit_posts') )\n\t\treturn;\n\n\t$awaiting_mod = wp_count_comments();\n\t$awaiting_mod = $awaiting_mod->moderated;\n\t$awaiting_title = esc_attr( sprintf( _n( '%s comment awaiting moderation', '%s comments awaiting moderation', $awaiting_mod ), number_format_i18n( $awaiting_mod ) ) );\n\n\t$icon  = '<span class=\"ab-icon\"></span>';\n\t$title = '<span id=\"ab-awaiting-mod\" class=\"ab-label awaiting-mod pending-count count-' . $awaiting_mod . '\">' . number_format_i18n( $awaiting_mod ) . '</span>';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'comments',\n\t\t'title' => $icon . $title,\n\t\t'href'  => admin_url('edit-comments.php'),\n\t\t'meta'  => array( 'title' => $awaiting_title ),\n\t) );\n}\n\n/**\n * Add appearance submenu items to the \"Site Name\" menu.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_appearance_menu( $wp_admin_bar ) {\n\t$wp_admin_bar->add_group( array( 'parent' => 'site-name', 'id' => 'appearance' ) );\n\n\tif ( current_user_can( 'switch_themes' ) || current_user_can( 'edit_theme_options' ) )\n\t\t$wp_admin_bar->add_menu( array( 'parent' => 'appearance', 'id' => 'themes', 'title' => __('Themes'), 'href' => admin_url('themes.php') ) );\n\n\tif ( ! current_user_can( 'edit_theme_options' ) )\n\t\treturn;\n\n\t$current_url = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent' => 'appearance',\n\t\t'id'     => 'customize',\n\t\t'title'  => __('Customize'),\n\t\t'href'   => add_query_arg( 'url', urlencode( $current_url ), wp_customize_url() ),\n\t\t'meta'   => array(\n\t\t\t'class' => 'hide-if-no-customize',\n\t\t),\n\t) );\n\tadd_action( 'wp_before_admin_bar_render', 'wp_customize_support_script' );\n\n\tif ( current_theme_supports( 'widgets' )  )\n\t\t$wp_admin_bar->add_menu( array( 'parent' => 'appearance', 'id' => 'widgets', 'title' => __('Widgets'), 'href' => admin_url('widgets.php') ) );\n\n\t if ( current_theme_supports( 'menus' ) || current_theme_supports( 'widgets' ) )\n\t\t$wp_admin_bar->add_menu( array( 'parent' => 'appearance', 'id' => 'menus', 'title' => __('Menus'), 'href' => admin_url('nav-menus.php') ) );\n\n\tif ( current_theme_supports( 'custom-background' ) )\n\t\t$wp_admin_bar->add_menu( array( 'parent' => 'appearance', 'id' => 'background', 'title' => __('Background'), 'href' => admin_url('themes.php?page=custom-background') ) );\n\n\tif ( current_theme_supports( 'custom-header' ) )\n\t\t$wp_admin_bar->add_menu( array( 'parent' => 'appearance', 'id' => 'header', 'title' => __('Header'), 'href' => admin_url('themes.php?page=custom-header') ) );\n}\n\n/**\n * Provide an update link if theme/plugin/core updates are available.\n *\n * @since 3.1.0\n */\nfunction wp_admin_bar_updates_menu( $wp_admin_bar ) {\n\n\t$update_data = wp_get_update_data();\n\n\tif ( !$update_data['counts']['total'] )\n\t\treturn;\n\n\t$title = '<span class=\"ab-icon\"></span><span class=\"ab-label\">' . number_format_i18n( $update_data['counts']['total'] ) . '</span>';\n\t$title .= '<span class=\"screen-reader-text\">' . $update_data['title'] . '</span>';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'id'    => 'updates',\n\t\t'title' => $title,\n\t\t'href'  => network_admin_url( 'update-core.php' ),\n\t\t'meta'  => array(\n\t\t\t'title' => $update_data['title'],\n\t\t),\n\t) );\n}\n\n/**\n * Add search form.\n *\n * @since 3.3.0\n */\nfunction wp_admin_bar_search_menu( $wp_admin_bar ) {\n\tif ( is_admin() )\n\t\treturn;\n\n\t$form  = '<form action=\"' . esc_url( home_url( '/' ) ) . '\" method=\"get\" id=\"adminbarsearch\">';\n\t$form .= '<input class=\"adminbar-input\" name=\"s\" id=\"adminbar-search\" type=\"text\" value=\"\" maxlength=\"150\" />';\n\t$form .= '<input type=\"submit\" class=\"adminbar-button\" value=\"' . __('Search') . '\"/>';\n\t$form .= '</form>';\n\n\t$wp_admin_bar->add_menu( array(\n\t\t'parent' => 'top-secondary',\n\t\t'id'     => 'search',\n\t\t'title'  => $form,\n\t\t'meta'   => array(\n\t\t\t'class'    => 'admin-bar-search',\n\t\t\t'tabindex' => -1,\n\t\t)\n\t) );\n}\n\n/**\n * Add secondary menus.\n *\n * @since 3.3.0\n */\nfunction wp_admin_bar_add_secondary_groups( $wp_admin_bar ) {\n\t$wp_admin_bar->add_group( array(\n\t\t'id'     => 'top-secondary',\n\t\t'meta'   => array(\n\t\t\t'class' => 'ab-top-secondary',\n\t\t),\n\t) );\n\n\t$wp_admin_bar->add_group( array(\n\t\t'parent' => 'wp-logo',\n\t\t'id'     => 'wp-logo-external',\n\t\t'meta'   => array(\n\t\t\t'class' => 'ab-sub-secondary',\n\t\t),\n\t) );\n}\n\n/**\n * Style and scripts for the admin bar.\n *\n * @since 3.1.0\n *\n */\nfunction wp_admin_bar_header() { ?>\n<style type=\"text/css\" media=\"print\">#wpadminbar { display:none; }</style>\n<?php\n}\n\n/**\n * Default admin bar callback.\n *\n * @since 3.1.0\n *\n */\nfunction _admin_bar_bump_cb() { ?>\n<style type=\"text/css\" media=\"screen\">\n\thtml { margin-top: 28px !important; }\n\t* html body { margin-top: 28px !important; }\n</style>\n<?php\n}\n\n/**\n * Set the display status of the admin bar.\n *\n * This can be called immediately upon plugin load. It does not need to be called from a function hooked to the init action.\n *\n * @since 3.1.0\n *\n * @param bool $show Whether to allow the admin bar to show.\n * @return void\n */\nfunction show_admin_bar( $show ) {\n\tglobal $show_admin_bar;\n\t$show_admin_bar = (bool) $show;\n}\n\n/**\n * Determine whether the admin bar should be showing.\n *\n * @since 3.1.0\n *\n * @return bool Whether the admin bar should be showing.\n */\nfunction is_admin_bar_showing() {\n\tglobal $show_admin_bar, $pagenow;\n\n\t// For all these types of requests, we never want an admin bar.\n\tif ( defined('XMLRPC_REQUEST') || defined('DOING_AJAX') || defined('IFRAME_REQUEST') )\n\t\treturn false;\n\n\t// Integrated into the admin.\n\tif ( is_admin() )\n\t\treturn true;\n\n\tif ( ! isset( $show_admin_bar ) ) {\n\t\tif ( ! is_user_logged_in() || 'wp-login.php' == $pagenow ) {\n\t\t\t$show_admin_bar = false;\n\t\t} else {\n\t\t\t$show_admin_bar = _get_admin_bar_pref();\n\t\t}\n\t}\n\n\t$show_admin_bar = apply_filters( 'show_admin_bar', $show_admin_bar );\n\n\treturn $show_admin_bar;\n}\n\n/**\n * Retrieve the admin bar display preference of a user.\n *\n * @since 3.1.0\n * @access private\n *\n * @param string $context Context of this preference check. Defaults to 'front'. The 'admin'\n * \tpreference is no longer used.\n * @param int $user Optional. ID of the user to check, defaults to 0 for current user.\n * @return bool Whether the admin bar should be showing for this user.\n */\nfunction _get_admin_bar_pref( $context = 'front', $user = 0 ) {\n\t$pref = get_user_option( \"show_admin_bar_{$context}\", $user );\n\tif ( false === $pref )\n\t\treturn true;\n\n\treturn 'true' === $pref;\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":21508}]],"length":21508}
